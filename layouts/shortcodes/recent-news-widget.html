{{/* Define the list of allowed Bootstrap color names */}}
{{ $colors := slice "warning" "success" "danger" "info" }}

{{/* Add the CSS directly into the shortcode using a <style> tag */}}
<style>
/* --- Base Card Styles --- */
.card-margin-bottom { 
    margin-bottom: 1.875rem;
}

.news-widget-card { 
    border: 0;
    box-shadow: 0px 0px 10px 0px rgba(82, 63, 105, 0.1);
    -webkit-box-shadow: 0px 0px 10px 0px rgba(82, 63, 105, 0.1);
    -moz-box-shadow: 0px 0px 10px 0px rgba(82, 63, 105, 0.1);
    -ms-box-shadow: 0px 0px 10px 0px rgba(82, 63, 105, 0.1);
    position: relative;
    display: flex;
    flex-direction: column;
    min-width: 0;
    word-wrap: break-word;
    background-color: #ffffff;
    background-clip: border-box;
    border: 1px solid #e6e4e9;
    border-radius: 8px;
    width: 100%; /* Full width */
}

/* --- Widget Styles --- */
.widget-49 .widget-49-title-wrapper {
  display: flex;
  align-items: center;
}

/* Base styles for all date widgets */
.widget-49 .widget-49-title-wrapper .widget-49-date {
  display: flex;
  align-items: center;
  justify-content: center;
  flex-direction: column;
  width: 4rem;
  height: 4rem;
  border-radius: 50%;
  flex-shrink: 0;
}
.widget-49 .widget-49-title-wrapper .widget-49-date .widget-49-date-day {
  font-weight: 500;
  font-size: 1.5rem;
  line-height: 1;
}
.widget-49 .widget-49-title-wrapper .widget-49-date .widget-49-date-month {
  line-height: 1;
  font-size: 1rem;
  text-transform: uppercase;
}

/* Color specific styles using Bootstrap variable fallbacks */
.widget-49 .widget-49-title-wrapper .widget-49-date-warning {
  background-color: var(--bs-warning-bg-subtle, #fff3cd);
}
.widget-49 .widget-49-title-wrapper .widget-49-date-warning .widget-49-date-day,
.widget-49 .widget-49-title-wrapper .widget-49-date-warning .widget-49-date-month {
  color: var(--bs-warning-text-emphasis, #664d03);
}

.widget-49 .widget-49-title-wrapper .widget-49-date-success {
  background-color: var(--bs-success-bg-subtle, #d1e7dd);
}
.widget-49 .widget-49-title-wrapper .widget-49-date-success .widget-49-date-day,
.widget-49 .widget-49-title-wrapper .widget-49-date-success .widget-49-date-month {
  color: var(--bs-success-text-emphasis, #0f5132);
}

.widget-49 .widget-49-title-wrapper .widget-49-date-danger {
  background-color: var(--bs-danger-bg-subtle, #f8d7da);
}
.widget-49 .widget-49-title-wrapper .widget-49-date-danger .widget-49-date-day,
.widget-49 .widget-49-title-wrapper .widget-49-date-danger .widget-49-date-month {
  color: var(--bs-danger-text-emphasis, #842029);
}

.widget-49 .widget-49-title-wrapper .widget-49-date-info {
  background-color: var(--bs-info-bg-subtle, #cff4fc);
}
.widget-49 .widget-49-title-wrapper .widget-49-date-info .widget-49-date-day,
.widget-49 .widget-49-title-wrapper .widget-49-date-info .widget-49-date-month {
  color: var(--bs-info-text-emphasis, #055160);
}

/* --- Meeting Info & Taxonomy --- */
.widget-49 .widget-49-title-wrapper .widget-49-meeting-info {
  display: flex;
  flex-direction: column;
  margin-left: 1rem;
  flex-grow: 1;
  min-width: 0;
}

.widget-49 .widget-49-title-wrapper .widget-49-meeting-info .widget-49-pro-title {
  color: #3c4142;
  font-size: 1.1rem;
  font-weight: 500;
  white-space: normal;
  overflow-wrap: break-word;
  word-wrap: break-word;
  word-break: break-word;
  margin-bottom: 0.3rem; /* Space below title */
}
.widget-49 .widget-49-title-wrapper .widget-49-meeting-info .widget-49-pro-title a {
  color: inherit;
  text-decoration: none;
}
.widget-49 .widget-49-title-wrapper .widget-49-meeting-info .widget-49-pro-title a:hover {
  text-decoration: underline;
}

/* Styles for Taxonomy (Tags/Categories) */
.widget-49-taxonomy-info {
    color: #868e96; /* Lighter text color */
    font-size: 0.8rem; /* Smaller font size */
    margin-top: 0.1rem;
    line-height: 1.4; /* Adjust line height for potential wrapping */
}
.widget-49-taxonomy-info .taxonomy-item {
    display: inline-block; /* Keep items inline */
    margin-right: 0.75rem; /* Space between taxonomy groups (cat/tag) */
    white-space: nowrap; /* Prevent breaking within a group initially */
}
.widget-49-taxonomy-info i {
    margin-right: 0.25rem; /* Space between icon and text */
    font-size: 0.75rem; /* Slightly smaller icon */
}
.widget-49-taxonomy-info a {
    color: inherit; /* Inherit color */
    text-decoration: none;
    margin-right: 0.3rem; /* Space between individual terms */
}
.widget-49-taxonomy-info a:hover {
    text-decoration: underline;
    color: #343a40; /* Darken on hover */
}


/* --- Summary & Action --- */
.widget-49 .widget-49-summary {
  font-weight: 400;
  font-size: 0.9rem;
  color: #727686;
  margin-top: 1rem;
  margin-bottom: 1rem;
}

.widget-49 .widget-49-meeting-action {
  text-align: right;
  margin-top: auto; /* Push button to the bottom */
  padding-top: 0.5rem;
}

/* --- Button Styles (Unchanged) --- */
.btn-flash-border {
  display: inline-block; padding: 0.375rem 0.75rem; font-size: 0.875rem; font-weight: 400;
  line-height: 1.5; text-align: center; text-decoration: none; vertical-align: middle;
  cursor: pointer; user-select: none; background-color: transparent; border: 1px solid transparent;
  border-radius: 0.25rem;
  transition: color 0.15s ease-in-out, background-color 0.15s ease-in-out, border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
  text-transform: uppercase;
}
.btn-flash-border-warning { color: var(--bs-warning, #ffc107); border-color: var(--bs-warning, #ffc107); }
.btn-flash-border-warning:hover { color: #000; background-color: var(--bs-warning, #ffc107); border-color: var(--bs-warning, #ffc107); }
.btn-flash-border-success { color: var(--bs-success, #198754); border-color: var(--bs-success, #198754); }
.btn-flash-border-success:hover { color: #fff; background-color: var(--bs-success, #198754); border-color: var(--bs-success, #198754); }
.btn-flash-border-danger { color: var(--bs-danger, #dc3545); border-color: var(--bs-danger, #dc3545); }
.btn-flash-border-danger:hover { color: #fff; background-color: var(--bs-danger, #dc3545); border-color: var(--bs-danger, #dc3545); }
.btn-flash-border-info { color: var(--bs-info, #0dcaf0); border-color: var(--bs-info, #0dcaf0); }
.btn-flash-border-info:hover { color: #000; background-color: var(--bs-info, #0dcaf0); border-color: var(--bs-info, #0dcaf0); }

/* New styles for vertical alignment */
.news-container {
  max-width: 80%;
  margin: 0 auto;
}

@media (max-width: 768px) {
  .news-container {
    max-width: 95%;
  }
}

/* Style for no news message */
.no-news-message {
  text-align: center;
  color: #6c757d;
  font-style: italic;
  padding: 2rem 0;
}
</style>

{{/* --- Shortcode HTML --- */}}
<div class="td-blog-posts-section mb-5">
  {{ $posts := where site.RegularPages "Section" "news" }}
  
  {{/* Filter posts to only include those less than one month old */}}
  {{ $now := now }}
  {{ $oneMonthAgo := $now.AddDate 0 -1 0 }}
  {{ $recentPosts := slice }}
  
  {{ range $posts.ByDate.Reverse }}
    {{ if gt .Date.Unix $oneMonthAgo.Unix }}
      {{ $recentPosts = $recentPosts | append . }}
    {{ end }}
  {{ end }}
  
  {{/* Change title based on whether there are recent posts */}}
  {{ if gt (len $recentPosts) 0 }}
    <h2>Recent News</h2>
  {{ else }}
    <h2>No Recent News</h2>
  {{ end }}
  
  <hr class="panel-line">

  <div class="news-container">
    {{ if gt (len $recentPosts) 0 }}
      <div class="row justify-content-center">
        {{ range $index, $post := first 3 $recentPosts }}
          {{ $randomColor := index (shuffle $colors) 0 }}
          <div class="col-12 mb-4">
            <div class="card news-widget-card">
              <div class="card-body pt-3">
                <div class="widget-49">
                  <div class="widget-49-title-wrapper">
                    <div class="widget-49-date widget-49-date-{{ $randomColor }}">
                      <span class="widget-49-date-day">{{ .Date.Format "02" }}</span>
                      <span class="widget-49-date-month">{{ .Date.Format "Jan" | lower }}</span>
                    </div>
                    <div class="widget-49-meeting-info">
                      <span class="widget-49-pro-title"><a href="{{ .RelPermalink }}">{{ .Title }}</a></span>
                      {{/* --- START: Taxonomy Section --- */}}
                      {{ if or .Params.categories .Params.tags }}
                      <div class="widget-49-taxonomy-info">
                          {{ with .Params.categories }}
                          <span class="taxonomy-item">
                              <i class="fas fa-folder"></i>
                              {{ range $idx, $category := . }}
                                  {{ if gt $idx 0 }}, {{ end }}<a href="{{ printf "/categories/%s/" (. | urlize) | absURL }}">{{ . }}</a>
                              {{ end }}
                          </span>
                          {{ end }}
                          {{ with .Params.tags }}
                          <span class="taxonomy-item">
                              <i class="fas fa-tag"></i>
                              {{ range $idx, $tag := . }}
                                  {{ if gt $idx 0 }}, {{ end }}<a href="{{ printf "/tags/%s/" (. | urlize) | absURL }}">{{ . }}</a>
                              {{ end }}
                          </span>
                          {{ end }}
                      </div>
                      {{ end }}
                      {{/* --- END: Taxonomy Section --- */}}
                    </div>
                  </div>
                  <p class="widget-49-summary">{{ .Description | default .Summary | truncate 100 }}</p>
                  <div class="widget-49-meeting-action">
                    <a href="{{ .RelPermalink }}" class="btn-flash-border btn-flash-border-{{ $randomColor }}">Read More</a>
                  </div>
                </div>
              </div>
            </div>
          </div>
        {{ end }}
      </div>
    {{ else }}
      <div class="no-news-message">There are no news items from the past month.</div>
    {{ end }}
  </div>
</div>
